import{a as h}from"./axios-G2rPRu76.js";import{_ as q,o as r,c,a as t,t as d,e as _,f as C,v as M,b as i,w as v,d as u,F as S,g as U,r as y,n as P,h as V}from"./index-S7qcWg5V.js";import{M as D}from"./bootstrap.esm-TTjMTX3M.js";const I={data(){return{status:{},modal:null,qty:1}},props:["product","addProduct"],methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()}},mounted(){this.modal=new D(this.$refs.modal)}},L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},R={class:"modal-dialog modal-xl",role:"document"},T={class:"modal-content border-0"},$={class:"modal-header bg-dark text-white"},F={class:"modal-title",id:"exampleModalLabel"},B=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),N={class:"modal-body"},O={class:"row"},z={class:"col-sm-6"},A=["src"],H={class:"col-sm-6"},j={class:"badge bg-primary rounded-pill"},G={key:0,class:"h5"},J={class:"h6"},K={class:"h5"},Q={class:"input-group"};function W(o,s,a,f,l,m){return r(),c("div",L,[t("div",R,[t("div",T,[t("div",$,[t("h5",F,[t("span",null,d(a.product.title),1)]),B]),t("div",N,[t("div",O,[t("div",z,[t("img",{class:"img-fluid",src:a.product.imageUrl,alt:""},null,8,A)]),t("div",H,[t("span",j,d(a.product.category),1),t("p",null,"商品描述："+d(a.product.description),1),t("p",null,"商品內容："+d(a.product.content),1),a.product.price?_("",!0):(r(),c("div",G,d(a.product.origin_price)+" 元",1)),t("del",J,"原價 "+d(a.product.origin_price)+" 元",1),t("div",K,"現在只要 "+d(a.product.price)+" 元",1),t("div",null,[t("div",Q,[C(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":s[0]||(s[0]=b=>l.qty=b)},null,512),[[M,l.qty,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=b=>a.addProduct(a.product.id,l.qty))},"加入購物車")])])])])])])])],512)}const X=q(I,[["render",W]]);var Y={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week6_npm_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_PATH:g}=Y,Z={data(){return{loadingState:{isloading:""},products:[],product:{},cart:{},qty:1,userPtModal:null,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getDatas(){h.get(`${p}/api/${g}/products`).then(o=>{this.products=o.data.products}).catch(o=>{alert(o.response.data.message)})},getData(o){this.loadingState.isloading=o,h.get(`${p}/api/${g}/product/${o}`).then(s=>{this.loadingState.isloading="",this.product=s.data.product,this.$refs.modal.openModal()}).catch(s=>{alert(s.response.data.message)})},getCart(){h.get(`${p}/api/${g}/cart`).then(o=>{this.cart=o.data.data}).catch(o=>{alert(o.response.data.message)})},addProduct(o,s=1){this.loadingState.isloading=o;const a={product_id:o,qty:s};h.post(`${p}/api/${g}/cart`,{data:a}).then(f=>{alert(f.data.message),this.loadingState.isloading="",this.$refs.modal.closeModal(),this.getCart()}).catch(f=>{alert(f.response.data.message)})},delCart(o){this.loadingState.isloading=o,h.delete(`${p}/api/${g}/cart/${o}`).then(s=>{this.loadingState.isloading="",alert(s.data.message),this.getCart()}).catch(s=>{alert(s.response.data.message)})},delItems(){h.delete(`${p}/api/${g}/carts`).then(o=>{alert(o.data.message),this.getCart()}).catch(o=>{alert(o.response.data.message)})},updateStatus(o){this.loadingState.isloading=o.id;const s={product_id:o.product_id,qty:o.qty};h.put(`${p}/api/${g}/cart/${o.id}`,{data:s}).then(a=>{this.loadingState.isloading="",this.getCart()}).catch(a=>{alert(a.response.data.message)})},addOrder(){if(this.cart.carts.length===0)alert("你的購物車是空的，無法送出訂單");else{const o=this.form;h.post(`${p}/api/${g}/order`,{data:o}).then(s=>{alert(s.data.message),this.$refs.form.resetForm(),this.loadingState.isloading="",this.getCart()}).catch(s=>{alert(s.response.data.message)})}}},mounted(){this.getDatas(),this.getCart()},components:{UserProductsModal:X}},tt=t("h2",{class:"mb-3"},"前台",-1),et=t("br",null,null,-1),st=t("h5",null,"首頁",-1),ot={class:"container"},lt={class:"mt-4"},at={class:"table align-middle"},dt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),nt={style:{width:"200px"}},it={key:0,calss:"h5"},rt={class:"h6"},ct={class:"h5"},ut={class:"btn-group btn-group-sm"},mt=["onClick","disabled"],_t={key:0,class:"fas fa-spinner fa-pulse"},ht=["onClick","disabled"],pt={key:0,class:"fas fa-spinner fa-pulse"},gt={class:"text-end"},bt={class:"table align-middle"},ft=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1),vt=["onClick","disabled"],yt={key:0,class:"fas fa-spinner fa-pulse"},xt={key:0,class:"text-success"},kt={class:"input-group input-group-sm"},Vt={class:"input-group mb-3"},St=["onUpdate:modelValue","onBlur","disabled"],Ct={class:"input-group-text",id:"basic-addon2"},Mt={class:"text-end"},Ut={key:0,class:"text-success"},qt=t("td",{colspan:"3",class:"text-end"},"總計",-1),wt={class:"text-end"},Et={key:0},Pt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Dt={class:"text-end text-success"},It={class:"my-5 row justify-content-center"},Lt={class:"mb-3"},Rt=t("label",{for:"email",class:"form-label"},"Email",-1),Tt={class:"mb-3"},$t=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ft={class:"mb-3"},Bt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Nt={class:"mb-3"},Ot=t("label",{for:"address",class:"form-label"},"收件人地址",-1),zt={class:"mb-3"},At=t("label",{for:"message",class:"form-label"},"留言",-1),Ht=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function jt(o,s,a,f,l,m){const b=y("RouterLink"),w=y("UserProductsModal"),x=y("VField"),k=y("ErrorMessage"),E=y("VForm");return r(),c(S,null,[tt,t("h5",null,[i(b,{to:"/"},{default:v(()=>[u("首頁")]),_:1}),u(" | "),i(b,{to:"/reception"},{default:v(()=>[u("前台產品列")]),_:1}),u(" | "),i(b,{to:"/login"},{default:v(()=>[u("登入")]),_:1}),u(" | "),i(b,{to:"/product"},{default:v(()=>[u("後台產品列")]),_:1})]),et,st,t("div",ot,[t("div",lt,[i(w,{ref:"modal",product:l.product,"add-product":m.addProduct},null,8,["product","add-product"]),t("table",at,[dt,t("tbody",null,[(r(!0),c(S,null,U(l.products,e=>(r(),c("tr",{key:e.id},[t("td",nt,[t("div",{style:P([{height:`100px
                              
                              background-size: cover`,"background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,d(e.title),1),t("td",null,[e.price?_("",!0):(r(),c("div",it,d(e.origin_price),1)),t("del",rt,"原價 "+d(e.origin_price)+" 元",1),t("div",ct,"現在只要 "+d(e.price)+" 元",1)]),t("td",null,[t("div",ut,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:n=>m.getData(e.id),disabled:l.loadingState.isloading===e.id||!e.is_enabled},[l.loadingState.isloading===e.id?(r(),c("i",_t)):_("",!0),u(" 查看更多 ")],8,mt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:n=>m.addProduct(e.id),disabled:l.loadingState.isloading===e.id||!e.is_enabled},[l.loadingState.isloading===e.id?(r(),c("i",pt)):_("",!0),u(" 加到購物車 ")],8,ht)])])]))),128))])]),t("div",gt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...e)=>m.delItems&&m.delItems(...e))},"清空購物車")]),t("table",bt,[ft,t("tbody",null,[l.cart.carts?(r(!0),c(S,{key:0},U(l.cart.carts,e=>(r(),c("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>m.delCart(e.id),disabled:l.loadingState.isloading===e.id},[l.loadingState.isloading===e.id?(r(),c("i",yt)):_("",!0),u(" x ")],8,vt)]),t("td",null,[u(d(e.product.title)+" ",1),e.coupon?(r(),c("div",xt," 已套用優惠券 ")):_("",!0)]),t("td",null,[t("div",kt,[t("div",Vt,[C(t("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":n=>e.qty=n,onBlur:n=>m.updateStatus(e),disabled:l.loadingState.isloading===e.id},null,40,St),[[M,e.qty,void 0,{number:!0}]]),t("span",Ct,d(e.product.unit),1)])])]),t("td",Mt,[e.final_total!==e.total?(r(),c("small",Ut,"折扣價：")):_("",!0),u(" "+d(e.final_total),1)])]))),128)):_("",!0)]),t("tfoot",null,[t("tr",null,[qt,t("td",wt,d(l.cart.total),1)]),l.cart.final_total!==l.cart.total?(r(),c("tr",Et,[Pt,t("td",Dt,d(l.cart.final_total),1)])):_("",!0)])])]),t("div",It,[i(E,{ref:"form",class:"col-md-6",onSubmit:m.addOrder},{default:v(({errors:e})=>[t("div",Lt,[Rt,i(x,{id:"email",name:"email",type:"email",class:V(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=n=>l.form.user.email=n)},null,8,["class","modelValue"]),i(k,{name:"email",class:"invalid-feedback"})]),t("div",Tt,[$t,i(x,{id:"name",name:"姓名",type:"text",class:V(["form-control",{"is-invalid":e.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=n=>l.form.user.name=n)},null,8,["class","modelValue"]),i(k,{name:"姓名",class:"invalid-feedback"})]),t("div",Ft,[Bt,i(x,{id:"tel",name:"電話",type:"text",class:V(["form-control",{"is-invalid":e.電話}]),placeholder:"請輸入電話，ex:092345532",rules:"required|min:9|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=n=>l.form.user.tel=n)},null,8,["class","modelValue"]),i(k,{name:"電話",class:"invalid-feedback"})]),t("div",Nt,[Ot,i(x,{id:"address",name:"地址",type:"text",class:V(["form-control",{"is-invalid":e.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=n=>l.form.user.address=n)},null,8,["class","modelValue"]),i(k,{name:"地址",class:"invalid-feedback"})]),t("div",zt,[At,C(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=n=>l.form.message=n)},null,512),[[M,l.form.message]])]),Ht]),_:1},8,["onSubmit"])])])],64)}const Qt=q(Z,[["render",jt]]);export{Qt as default};
